# 错误处理使用指南

## 概述

为了解决状态码110002（"请登录"）被误导为"没网"等问题，我们实现了统一的错误处理机制。

## 核心改进

### 1. request.js 优化
- 当接口返回状态码110002时，会自动跳转到登录页面
- 返回的错误对象包含 `isLoginError: true` 和 `needLogin: true` 标识
- 避免页面显示误导性的错误信息

### 2. 统一错误处理工具
- `utils/errorHandler.js` - 核心错误处理工具
- `mixins/errorHandling.js` - 全局混入，所有页面可直接使用

## 使用方法

### 方法1：使用全局混入方法（推荐）

```javascript
// 在任何页面中直接使用
export default {
    methods: {
        async loadData() {
            try {
                const res = await someApi();
                // 处理成功逻辑
            } catch (error) {
                // 使用统一错误处理
                this.$handleError(error, {
                    defaultMsg: '获取数据失败，请稍后重试'
                });
            }
        }
    }
}
```

### 方法2：使用安全API调用包装器

```javascript
export default {
    methods: {
        async loadData() {
            try {
                const res = await this.$safeApiCall(
                    someApi(), 
                    {
                        loadingText: '加载中...',
                        errorMsg: '获取数据失败',
                        showLoading: true
                    }
                );
                // 处理成功逻辑
            } catch (error) {
                // 错误已经被自动处理，这里可以做额外处理
                console.log('API调用失败');
            }
        }
    }
}
```

### 方法3：直接导入使用

```javascript
import errorHandler from '@/utils/errorHandler.js';

export default {
    methods: {
        async loadData() {
            try {
                const res = await someApi();
                // 处理成功逻辑
            } catch (error) {
                errorHandler.handleApiError(error, {
                    defaultMsg: '获取数据失败，请稍后重试'
                });
            }
        }
    }
}
```

## API 参考

### $handleError(error, options)
处理API请求错误

**参数：**
- `error` - 错误对象或错误信息
- `options` - 配置选项
  - `showToast` - 是否显示Toast提示，默认true
  - `defaultMsg` - 默认错误信息
  - `silent` - 是否静默处理，默认false

### $isLoginError(error)
检查是否为登录相关错误

**返回：** Boolean

### $getFriendlyErrorMsg(error, defaultMsg)
获取友好的错误信息

**返回：** String

### $safeApiCall(apiCall, options)
安全的API调用包装器

**参数：**
- `apiCall` - API调用Promise
- `options` - 配置选项
  - `loadingText` - 加载提示文字
  - `errorMsg` - 错误提示信息
  - `showLoading` - 是否显示加载提示
  - `silent` - 是否静默处理错误

## 错误类型处理

### 1. 登录相关错误（状态码110002, 110003, 110004）
- ✅ 显示友好的模态框提示："登录已过期，即将跳转到登录页面"
- ✅ 用户点击确定后跳转到登录页面
- ✅ 不显示误导性错误信息
- ✅ 提供良好的用户体验，避免突然跳转

### 2. 网络错误
- ✅ 显示"网络连接失败，请检查网络设置"
- ✅ 区分真正的网络问题

### 3. 业务错误
- ✅ 显示服务器返回的具体错误信息
- ✅ 提供友好的用户提示

## 最佳实践

1. **优先使用全局混入方法**，代码更简洁
2. **为不同场景提供合适的错误信息**
3. **登录相关错误不需要额外处理**，系统会自动跳转
4. **重要操作使用 $safeApiCall**，自动处理加载状态

## 示例页面

参考 `pages/index/hot-group/index.vue` 中的实现方式。
