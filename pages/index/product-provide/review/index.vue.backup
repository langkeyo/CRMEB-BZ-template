<template>
    <view class="review-page">
        <!-- 状态栏占位 -->
        <view class="status-bar" :style="'height:' + statusBarHeight + 'px'"></view>

        <!-- 顶部导航 -->
        <view class="header">
            <view class="back-icon" @tap="goBack">
                <image src="/static/images/product-provide/back_icon.svg" class="icon-image"></image>
            </view>
            <text class="page-title">资料审核</text>
            <view class="right-placeholder"></view>
        </view>

        <view class="divider"></view>

        <!-- 审核状态内容 -->
        <view class="review-content">
            <!-- 进度指示器 -->
            <view class="progress-bar">
                <view class="progress-step active">
                    <view class="step-dot"></view>
                    <text class="step-text">信息提交</text>
                </view>
                <view class="progress-line" :class="{ 'active': currentStatus >= 1 }"></view>
                <view class="progress-step" :class="{ 'active': currentStatus >= 1 }">
                    <view class="step-dot"></view>
                    <text class="step-text">审核中</text>
                </view>
                <view class="progress-line" :class="{ 'active': currentStatus >= 2 }"></view>
                <view class="progress-step" :class="{ 'active': currentStatus >= 2 }">
                    <view class="step-dot"></view>
                    <text class="step-text">审核通过</text>
                </view>
            </view>

            <!-- 状态信息 -->
            <view class="status-info">
                <!-- 信息提交成功状态 -->
                <block v-if="currentStatus === 0">
                    <image src="/static/images/index/icons/success_icon.svg" class="status-icon"></image>
                    <view class="status-title">信息提交成功</view>
                    <view class="status-desc">工作人员将在3个工作日内处理</view>
                </block>

                <!-- 正在审核状态 -->
                <block v-if="currentStatus === 1">
                    <image src="/static/images/index/icons/loading_icon.svg" class="status-icon"></image>
                    <view class="status-title">正在审核</view>
                    <view class="status-desc">请耐心等待</view>
                </block>

                <!-- 审核通过状态 -->
                <block v-if="currentStatus === 2">
                    <image src="/static/images/index/icons/success_icon.svg" class="status-icon"></image>
                    <view class="status-title">审核通过</view>
                    <view class="status-desc">恭喜您审核通过，可以开始准备产品了</view>
                </block>
            </view>

            <!-- 按钮区域 -->
            <view class="button-area">
                <!-- 正在审核状态显示刷新按钮 -->
                <view v-if="currentStatus === 1" class="refresh-btn" @tap="refreshStatus">刷新</view>

                <!-- 审核通过状态显示去看看按钮 -->
                <view v-if="currentStatus === 2" class="next-btn" @tap="goToCompleted">去看看</view>
            </view>
        </view>
    </view>
</template>

<script>
export default {
    data () {
        return {
            statusBarHeight: 20, // 默认值，会在onLoad中获取真实值
            currentStatus: 0, // 0-信息提交成功，1-正在审核，2-审核通过
            timer: null
        }
    },
    onLoad (options) {
        // 获取状态栏高度
        this.statusBarHeight = uni.getSystemInfoSync().statusBarHeight

        // 如果有传入状态参数，则使用传入的状态
        if (options && options.status) {
            this.currentStatus = parseInt(options.status)
        } else {
            // 初始状态为信息提交成功
            this.currentStatus = 0

            // 模拟状态变化，3秒后进入审核中状态
            this.timer = setTimeout(() => {
                this.currentStatus = 1
            }, 3000)
        }
    },
    onUnload () {
        // 清除定时器
        if (this.timer) {
            clearTimeout(this.timer)
            this.timer = null
        }
    },
    methods: {
        goBack () {
            uni.navigateBack()
        },
        // 刷新状态
        refreshStatus () {
            uni.showLoading({
                title: '刷新中...'
            })

            // 模拟刷新，1.5秒后更新状态
            setTimeout(() => {
                uni.hideLoading()
                // 模拟有50%概率审核通过
                if (Math.random() > 0.5) {
                    this.currentStatus = 2
                } else {
                    uni.showToast({
                        title: '暂无更新',
                        icon: 'none'
                    })
                }
            }, 1500)
        },
        // 前往完成页面
        goToCompleted () {
            uni.navigateTo({
                url: '/pages/index/product-provide/completed/index'
            })
        }
    }
}
</script>

<style lang="scss" scoped>
.review-page {
    min-height: 100vh;
    background-color: #FFFFFF;
    position: relative;
    display: flex;
    flex-direction: column;
}

/* 状态栏 */
.status-bar {
    background-color: #FFFFFF;
}

/* 顶部导航 */
.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 44px;
    padding: 0 16px;
    background-color: #FFFFFF;

    .back-icon {
        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;

        .icon-image {
            width: 20px;
            height: 20px;
        }
    }

    .page-title {
        font-size: 18px;
        font-weight: 400;
        color: #1A1A1A;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
    }

    .right-placeholder {
        width: 28px;
    }
}

.divider {
    height: 0.5px;
    background-color: #F2F2F2;
    width: 100%;
}

/* 审核内容 */
.review-content {
    flex: 1;
    padding: 40px 20px;
    display: flex;
    flex-direction: column;
    align-items: center;

    /* 进度指示器 */
    .progress-bar {
        width: 80%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 60px;

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;

            .step-dot {
                width: 16px;
                height: 16px;
                border-radius: 50%;
                background-color: #CCCCCC;
                margin-bottom: 8px;
            }

            .step-text {
                font-size: 14px;
                color: #999999;
            }

            &.active {
                .step-dot {
                    background-color: #FFC082;
                }

                .step-text {
                    color: #FFC082;
                }
            }
        }

        .progress-line {
            flex: 1;
            height: 2px;
            background-color: #CCCCCC;

            &.active {
                background-color: #FFC082;
            }
        }
    }

    /* 状态信息 */
    .status-info {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 60px;

        .status-icon {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
        }

        .status-title {
            font-size: 24px;
            font-weight: 500;
            color: #1A1A1A;
            margin-bottom: 12px;
        }

        .status-desc {
            font-size: 14px;
            color: #999999;
        }
    }

    /* 按钮区域 */
    .button-area {
        margin-top: auto;
        width: 100%;

        .refresh-btn,
        .next-btn {
            width: 100%;
            height: 50px;
            line-height: 50px;
            text-align: center;
            border-radius: 25px;
            font-size: 16px;
        }

        .refresh-btn {
            background-color: #F7F7F7;
            color: #666666;
        }

        .next-btn {
            background-color: #FFC082;
            color: #FFFFFF;
        }
    }
}
</style>