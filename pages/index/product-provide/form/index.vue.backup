<template>
    <view class="form-page">
        <!-- 状态栏占位 -->
        <view class="status-bar" :style="'height:' + statusBarHeight + 'px'"></view>

        <!-- 顶部导航 -->
        <view class="header">
            <view class="left-area">
                <view class="back-icon" @tap="goBack">
                    <image src="/static/images/product-provide/back_icon.svg" class="icon-image"></image>
                </view>
                <text class="cancel-text" @tap="goBack">取消</text>
            </view>
            <text class="page-title">基本信息</text>
            <view class="right-placeholder"></view>
        </view>

        <view class="divider"></view>

        <!-- 表单内容 -->
        <scroll-view scroll-y class="form-content">
            <!-- 营业执照 -->
            <view class="form-item">
                <view class="form-label">营业执照照片：</view>
                <view class="upload-container">
                    <view class="upload-box" @tap="chooseImage('business')">
                        <text class="upload-plus">+</text>
                        <text class="upload-text">营业执照照片</text>
                    </view>
                    <image v-if="formData.businessLicense" :src="formData.businessLicense" class="preview-image"
                        mode="aspectFill"></image>
                </view>
            </view>

            <!-- 产品照片 -->
            <view class="form-item">
                <view class="form-label">产品照片：</view>
                <view class="upload-container">
                    <view class="upload-box" @tap="chooseImage('product')">
                        <text class="upload-plus">+</text>
                        <text class="upload-text">上传产品照片</text>
                    </view>
                    <image v-if="formData.productImage" :src="formData.productImage" class="preview-image"
                        mode="aspectFill"></image>
                </view>
            </view>

            <!-- 卫生许可证 -->
            <view class="form-item">
                <view class="form-label">卫生许可证：</view>
                <view class="upload-container">
                    <view class="upload-box" @tap="chooseImage('license')">
                        <text class="upload-plus">+</text>
                        <text class="upload-text">上传卫生许可证照片</text>
                    </view>
                    <image v-if="formData.hygieneLicense" :src="formData.hygieneLicense" class="preview-image"
                        mode="aspectFill"></image>
                </view>
            </view>

            <!-- 产品来源商 -->
            <view class="form-item">
                <view class="form-label">产品来源商：</view>
                <input class="form-input" type="text" placeholder="请输入来源商" v-model="formData.productSource" />
            </view>

            <!-- 法人身份证明 -->
            <view class="form-item">
                <view class="form-label">法人身份证明：</view>
                <view class="identity-hint">
                    <text class="identity-text">居民身份证</text>
                    <text class="identity-desc">需上传营业执照中的法人身份证明</text>
                </view>
                <view class="upload-row">
                    <view class="upload-box half" @tap="chooseImage('idFront')">
                        <text class="upload-plus">+</text>
                        <text class="upload-text">身份证正面照片</text>
                    </view>
                    <view class="upload-box half" @tap="chooseImage('idBack')">
                        <text class="upload-plus">+</text>
                        <text class="upload-text">身份证背面照片</text>
                    </view>
                </view>
                <view class="preview-row" v-if="formData.idCardFront || formData.idCardBack">
                    <image v-if="formData.idCardFront" :src="formData.idCardFront" class="preview-image half"
                        mode="aspectFill"></image>
                    <image v-if="formData.idCardBack" :src="formData.idCardBack" class="preview-image half"
                        mode="aspectFill"></image>
                </view>
            </view>

            <!-- 产品介绍 -->
            <view class="form-item">
                <view class="form-label">产品介绍：</view>
                <textarea class="form-textarea" placeholder="请输入产品的介绍内容" v-model="formData.productDesc"></textarea>
            </view>
        </scroll-view>

        <!-- 提交按钮 -->
        <view class="submit-btn" @tap="submitForm">提交</view>

        <!-- 底部安全区占位 -->
        <view class="safe-area"></view>
    </view>
</template>

<script>
export default {
    data () {
        return {
            statusBarHeight: 20, // 默认值，会在onLoad中获取真实值
            formData: {
                businessLicense: '', // 营业执照照片
                productImage: '', // 产品照片
                hygieneLicense: '', // 卫生许可证
                productSource: '', // 产品来源商
                idCardFront: '', // 身份证正面
                idCardBack: '', // 身份证背面
                productDesc: '' // 产品介绍
            }
        }
    },
    onLoad () {
        // 获取状态栏高度
        this.statusBarHeight = uni.getSystemInfoSync().statusBarHeight
    },
    methods: {
        goBack () {
            uni.navigateBack()
        },
        // 选择图片
        chooseImage (type) {
            uni.chooseImage({
                count: 1,
                sizeType: ['compressed'],
                sourceType: ['album', 'camera'],
                success: (res) => {
                    // 根据类型设置不同的图片
                    const tempFilePath = res.tempFilePaths[0]
                    switch (type) {
                        case 'business':
                            this.formData.businessLicense = tempFilePath
                            break
                        case 'product':
                            this.formData.productImage = tempFilePath
                            break
                        case 'license':
                            this.formData.hygieneLicense = tempFilePath
                            break
                        case 'idFront':
                            this.formData.idCardFront = tempFilePath
                            break
                        case 'idBack':
                            this.formData.idCardBack = tempFilePath
                            break
                    }
                }
            })
        },
        // 提交表单
        submitForm () {
            // 简单的表单验证
            if (!this.formData.businessLicense) {
                uni.showToast({
                    title: '请上传营业执照照片',
                    icon: 'none'
                })
                return
            }

            if (!this.formData.productImage) {
                uni.showToast({
                    title: '请上传产品照片',
                    icon: 'none'
                })
                return
            }

            if (!this.formData.hygieneLicense) {
                uni.showToast({
                    title: '请上传卫生许可证',
                    icon: 'none'
                })
                return
            }

            if (!this.formData.productSource) {
                uni.showToast({
                    title: '请输入产品来源商',
                    icon: 'none'
                })
                return
            }

            if (!this.formData.idCardFront || !this.formData.idCardBack) {
                uni.showToast({
                    title: '请上传法人身份证明',
                    icon: 'none'
                })
                return
            }

            if (!this.formData.productDesc) {
                uni.showToast({
                    title: '请输入产品介绍',
                    icon: 'none'
                })
                return
            }

            // 模拟提交成功
            uni.showLoading({
                title: '提交中...'
            })

            setTimeout(() => {
                uni.hideLoading()
                // 跳转到审核状态页面
                uni.navigateTo({
                    url: '/pages/index/product-provide/review/index'
                })
            }, 1500)
        }
    }
}
</script>

<style lang="scss" scoped>
.form-page {
    min-height: 100vh;
    background-color: #FFFFFF;
    position: relative;
    display: flex;
    flex-direction: column;
}

/* 状态栏 */
.status-bar {
    background-color: #FFFFFF;
}

/* 顶部导航 */
.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 44px;
    padding: 0 16px;
    background-color: #FFFFFF;

    .left-area {
        display: flex;
        align-items: center;

        .back-icon {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 5px;

            .icon-image {
                width: 20px;
                height: 20px;
            }
        }

        .cancel-text {
            font-size: 18px;
            color: #7E7E7E;
        }
    }

    .page-title {
        font-size: 18px;
        font-weight: 400;
        color: #1A1A1A;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
    }

    .right-placeholder {
        width: 28px;
    }
}

.divider {
    height: 0.5px;
    background-color: #F2F2F2;
    width: 100%;
}

/* 表单内容 */
.form-content {
    flex: 1;
    padding: 0 16px 80px;

    .form-item {
        padding: 16px 0;
        border-bottom: 0.5px solid #F2F2F2;

        .form-label {
            font-size: 16px;
            color: #1A1A1A;
            margin-bottom: 12px;
        }

        .upload-container {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .upload-box {
            width: 100px;
            height: 100px;
            border: 1px dashed #B3B3B3;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-right: 10px;
            margin-bottom: 10px;

            &.half {
                width: calc(50% - 5px);
                margin-right: 10px;

                &:last-child {
                    margin-right: 0;
                }
            }

            .upload-plus {
                font-size: 40px;
                line-height: 1;
                color: #B3B3B3;
                margin-bottom: 5px;
            }

            .upload-text {
                font-size: 12px;
                color: #999999;
                text-align: center;
                padding: 0 5px;
            }
        }

        .preview-image {
            width: 100px;
            height: 100px;
            border-radius: 4px;

            &.half {
                width: calc(50% - 5px);
                height: 100px;
            }
        }

        .upload-row,
        .preview-row {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 10px;
        }

        .form-input {
            width: 100%;
            height: 40px;
            font-size: 14px;
            color: #333333;
            padding: 0 10px;
        }

        .form-textarea {
            width: 100%;
            height: 120px;
            background-color: #F7F7F7;
            border-radius: 4px;
            padding: 10px;
            font-size: 12px;
            color: #333333;
        }

        .identity-hint {
            margin-bottom: 15px;

            .identity-text {
                font-size: 14px;
                color: #1A1A1A;
                margin-right: 10px;
            }

            .identity-desc {
                font-size: 14px;
                color: #999999;
            }
        }
    }
}

/* 底部按钮 */
.submit-btn {
    width: 100%;
    height: 50px;
    line-height: 50px;
    background-color: #FFC082;
    color: #FFFFFF;
    font-size: 16px;
    text-align: center;
    position: fixed;
    bottom: 34px;
    left: 0;
}

.safe-area {
    height: 34px;
}
</style>