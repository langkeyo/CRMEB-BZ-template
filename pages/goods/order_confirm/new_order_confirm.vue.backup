<template>
	<view class="order-confirm">
		<!-- 支付方式选择弹窗 -->
		<view class="payment-mask" v-if="showPaymentModal" @click.stop="closePaymentModal"></view>
		<view class="payment-modal" v-if="showPaymentModal">
			<view class="payment-options">
				<view class="payment-option" @click="selectPayment('alipay')">
					<view class="payment-icon alipay-icon">
						<image src="/static/images/payment/alipay_icon.png" mode="widthFix"></image>
					</view>
					<view class="payment-name">支付宝支付</view>
					<view class="payment-check" :class="{active: selectedPayment === 'alipay'}"></view>
				</view>
				<view class="payment-option" @click="selectPayment('wechat')">
					<view class="payment-icon wechat-icon">
						<image src="/static/images/payment/wechat_icon.png" mode="widthFix"></image>
					</view>
					<view class="payment-name">微信支付</view>
					<view class="payment-check" :class="{active: selectedPayment === 'wechat'}"></view>
				</view>
				<view class="more-payment">
					<text>更多支付方式</text>
					<image src="/static/images/payment/arrow_down.png" mode="widthFix"></image>
				</view>
			</view>
			<view class="payment-btn" @click="confirmPayment">
				<text>立即支付 ¥{{goods.price}}</text>
			</view>
		</view>
		<!-- 顶部状态栏 -->
		<view class="status-bar"></view>

		<!-- 导航栏 -->
		<view class="nav-bar">
			<view class="back-icon" @tap="goBack">
				<image src="/static/images/back_icon.svg" mode="aspectFit"></image>
			</view>
			<view class="title">确认订单</view>
		</view>

		<!-- 收货地址区域 -->
		<view class="address-box">
			<view class="location-icon">
				<image src="/static/images/location_icon.svg" mode="aspectFit"></image>
			</view>
			<view class="address-info">
				<view class="user-info">收货人：Eetin</view>
				<view class="address-detail">收货地址：北京尚德井小区菜鸟驿站</view>
				<view class="delivery-time">送货时间：今日8：00前送达</view>
				<view class="delivery-type">站点自提</view>
			</view>
		</view>

		<!-- 商品信息 -->
		<view class="goods-box">
			<view class="goods-image">
				<image src="/static/images/lemon.jpg" mode="aspectFill"></image>
			</view>
			<view class="goods-info">
				<view class="goods-name">香水柠檬50g/个</view>
				<view class="price-change">比加入时降价￥2元</view>
				<view class="price">￥15</view>

				<!-- 数量加减 -->
				<view class="quantity-box">
					<view class="minus" @tap="minusQuantity">
						<text>-</text>
					</view>
					<view class="quantity">1</view>
					<view class="plus" @tap="addQuantity">
						<text>+</text>
					</view>
				</view>

				<!-- 坏果包赔 -->
				<view class="guarantee-tag">
					<text>坏果包赔</text>
				</view>
			</view>
		</view>

		<!-- 费用信息 -->
		<view class="fee-box">
			<view class="fee-item">
				<text>打包费</text>
				<text>￥0</text>
			</view>
			<view class="fee-item">
				<text>配送费</text>
				<text>￥0</text>
			</view>
			<view class="fee-item">
				<text>商家代金券</text>
				<view class="coupon-info">
					<text>暂无可用</text>
					<text class="arrow">></text>
				</view>
			</view>
		</view>

		<!-- 推荐商品 -->
		<view class="recommend-box">
			<view class="recommend-title">顺手买一件</view>
			<view class="recommend-list">
				<view class="recommend-item">
					<image src="/static/images/recommend/fruit_kiwi.jpg" mode="aspectFill" class="recommend-image">
					</image>
					<view class="recommend-name">刺小野新款猕猴桃</view>
					<view class="recommend-price">￥19.8</view>
				</view>
				<view class="recommend-item">
					<image src="/static/images/recommend/toothbrush.jpg" mode="aspectFill" class="recommend-image">
					</image>
					<view class="recommend-name">双重软毛电动牙刷</view>
					<view class="recommend-price">￥29.8</view>
				</view>
				<view class="recommend-item">
					<image src="/static/images/recommend/fashion_bag.jpg" mode="aspectFill" class="recommend-image">
					</image>
					<view class="recommend-name">高级感时尚百搭单肩包</view>
					<view class="recommend-price">￥156</view>
				</view>
			</view>
		</view>

		<!-- 底部支付栏 -->
		<view class="bottom-bar">
			<view class="payment-info">
				<text class="payment-label">待支付：</text>
				<text class="payment-price">￥15.00</text>
			</view>

			<view class="payment-buttons">
				<view class="order-first-btn" @tap="orderFirst">先下单</view>
				<view class="pay-now-btn" @tap="payNow">立即支付</view>
			</view>
		</view>
	</view>
</template>

<script>
export default {
	data () {
		return {
			showPaymentModal: false, // 支付弹窗显示状态
			selectedPayment: 'wechat', // 默认选择微信支付
			goods: {
				name: '香水柠檬50g/个',
				price: 15,
				oldPrice: 17,
				quantity: 1,
				image: '/static/images/lemon.jpg'
			},
			address: {
				name: 'Eetin',
				location: '北京尚德井小区菜鸟驿站',
				deliveryTime: '今日8：00前送达',
				type: '站点自提'
			},
			recommendProducts: [
				{
					id: 1,
					name: '刺小野新款猕猴桃',
					price: 19.8,
					image: '/static/images/recommend/fruit_kiwi.jpg'
				},
				{
					id: 2,
					name: '双重软毛电动牙刷',
					price: 29.8,
					image: '/static/images/recommend/toothbrush.jpg'
				},
				{
					id: 3,
					name: '高级感时尚百搭单肩包',
					price: 156,
					image: '/static/images/recommend/fashion_bag.jpg'
				}
			]
		}
	},
	methods: {
		goBack () {
			uni.navigateBack()
		},
		minusQuantity () {
			if (this.goods.quantity > 1) {
				this.goods.quantity--
			}
		},
		addQuantity () {
			this.goods.quantity++
		},
		payNow () {
			// 显示支付方式选择弹窗
			this.showPaymentModal = true
		},
		orderFirst () {
			// 实现先下单逻辑
			uni.showToast({
				title: '创建订单成功',
				icon: 'success'
			})
		},

		// 选择支付方式
		selectPayment (type) {
			this.selectedPayment = type
		},

		// 关闭支付弹窗
		closePaymentModal () {
			this.showPaymentModal = false
		},

		// 确认支付
		confirmPayment () {
			// 储存选择的支付方式
			uni.setStorageSync('selectedPaymentMethod', this.selectedPayment)

			// 根据选择的支付方式调用支付接口
			uni.showLoading({
				title: '正在支付...'
			})

			// 模拟支付流程
			setTimeout(() => {
				uni.hideLoading()
				uni.showToast({
					title: '支付成功',
					icon: 'success'
				})

				// 跳转到支付成功页面
				setTimeout(() => {
					uni.redirectTo({
						url: '/pages/goods/order_pay_status/index?status=success'
					})
				}, 1500)
			}, 2000)

			// 关闭弹窗
			this.showPaymentModal = false
		}
	}
}
</script>

<style lang="scss">
.order-confirm {
	background-color: #F7F7F7;
	min-height: 100vh;
	position: relative;
}

.status-bar {
	height: 44px;
	background-color: #FFFFFF;
}

.nav-bar {
	display: flex;
	align-items: center;
	height: 44px;
	position: relative;
	background-color: #FFFFFF;
	padding: 0 15px;

	.back-icon {
		width: 24px;
		height: 24px;
		display: flex;
		align-items: center;
		justify-content: center;

		image {
			width: 20px;
			height: 20px;
		}
	}

	.title {
		position: absolute;
		left: 0;
		right: 0;
		text-align: center;
		font-size: 18px;
		color: #333;
		font-weight: 400;
	}
}

.address-box {
	margin: 20rpx;
	background-color: #E7EAF4;
	border-radius: 28rpx;
	padding: 30rpx 20rpx;
	display: flex;
	position: relative;

	.location-icon {
		width: 40rpx;
		height: 40rpx;
		margin-right: 20rpx;

		image {
			width: 100%;
			height: 100%;
		}
	}

	.address-info {
		flex: 1;

		.user-info,
		.address-detail,
		.delivery-time {
			font-size: 14px;
			color: #333;
			margin-bottom: 10rpx;
			line-height: 1.4;
		}

		.delivery-type {
			display: inline-block;
			font-size: 16px;
			color: #000;
			margin-top: 10rpx;
		}
	}
}

.goods-box {
	margin: 20rpx;
	background-color: #FFFFFF;
	border-radius: 8rpx;
	padding: 20rpx;
	display: flex;

	.goods-image {
		width: 160rpx;
		height: 160rpx;
		margin-right: 20rpx;

		image {
			width: 100%;
			height: 100%;
			border-radius: 14rpx;
		}
	}

	.goods-info {
		flex: 1;
		position: relative;

		.goods-name {
			font-size: 16px;
			color: #333;
			margin-bottom: 10rpx;
		}

		.price-change {
			font-size: 12px;
			color: #333;
			margin-top: 10rpx;
		}

		.price {
			font-size: 20px;
			color: #333;
			margin-top: 15rpx;
		}

		.quantity-box {
			position: absolute;
			right: 0;
			top: 0;
			display: flex;
			align-items: center;
			border: 1px solid #EDEDED;
			border-radius: 94rpx;

			.minus,
			.plus {
				width: 60rpx;
				height: 60rpx;
				display: flex;
				align-items: center;
				justify-content: center;

				text {
					font-size: 24rpx;
				}
			}

			.quantity {
				width: 60rpx;
				text-align: center;
				font-size: 14px;
			}
		}

		.guarantee-tag {
			display: inline-block;
			border: 0.5px solid #FF840B;
			border-radius: 8rpx;
			padding: 2rpx 8rpx;
			margin-top: 20rpx;

			text {
				font-size: 10px;
				color: #FF840B;
			}
		}
	}
}

.fee-box {
	margin: 20rpx;
	background-color: #FFFFFF;
	border-radius: 8rpx;
	padding: 20rpx;

	.fee-item {
		display: flex;
		justify-content: space-between;
		margin-bottom: 20rpx;

		text {
			font-size: 14px;
			color: #333;
		}

		.coupon-info {
			display: flex;
			align-items: center;

			text {
				font-size: 12px;
				color: #999;
			}

			.arrow {
				margin-left: 5rpx;
			}
		}
	}
}

.recommend-box {
	margin: 20rpx;
	margin-bottom: calc(240rpx + env(safe-area-inset-bottom));
	background-color: #FFFFFF;
	border-radius: 8rpx;
	padding: 20rpx;

	.recommend-title {
		font-size: 14px;
		color: #1A1A1A;
		margin-bottom: 20rpx;
	}

	.recommend-list {
		display: flex;
		justify-content: space-between;

		.recommend-item {
			width: 30%;

			.recommend-image {
				width: 100%;
				height: 180rpx;
				border-radius: 8rpx;
			}

			.recommend-name {
				font-size: 15px;
				color: #1A1A1A;
				margin-top: 10rpx;
				line-height: 1.4;
				display: -webkit-box;
				-webkit-box-orient: vertical;
				-webkit-line-clamp: 2;
				overflow: hidden;
			}

			.recommend-price {
				font-size: 18px;
				color: #1A1A1A;
				margin-top: 10rpx;
			}
		}
	}
}

.bottom-bar {
	position: fixed;
	left: 0;
	right: 0;
	bottom: 0;
	background-color: #FFFFFF;
	box-shadow: 0px 4px 21px 0px rgba(0, 0, 0, 0.25);
	padding: 20rpx;
	padding-bottom: calc(20rpx + env(safe-area-inset-bottom));
	display: flex;
	justify-content: space-between;
	align-items: center;
	z-index: 99;

	.payment-info {
		.payment-label {
			font-size: 12px;
			color: #737373;
		}

		.payment-price {
			font-size: 12px;
			color: #333;
		}
	}

	.payment-buttons {
		display: flex;

		.pay-now-btn,
		.order-first-btn {
			width: 180rpx;
			height: 88rpx;
			border-radius: 44px;
			color: #FFFFFF;
			font-size: 18px;
			display: flex;
			align-items: center;
			justify-content: center;
			margin-left: 20rpx;
		}

		.pay-now-btn {
			background: linear-gradient(to right, #FF7E00, #FDA44D);
		}

		.order-first-btn {
			/* 浅色橙色边框按钮 */
			background: #FFFFFF;
			color: #FF7E00;
			border: 1px solid #FF7E00;
		}
	}
}
/* 支付弹窗样式 */
.payment-mask {
	position: fixed;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	background-color: rgba(0, 0, 0, 0.6);
	z-index: 999;
}

.payment-modal {
	position: fixed;
	left: 0;
	right: 0;
	bottom: 0;
	background-color: #FFFFFF;
	border-radius: 4px 4px 0 0; /* 根据Figma设计稿修改圆角为4px */
	z-index: 1000;
	overflow: hidden;

	.payment-options {
		padding: 20px 16px;

		.payment-option {
			display: flex;
			align-items: center;
			height: 54px;
			margin-bottom: 15px;
			position: relative;

			.payment-icon {
				width: 23px; /* 根据Figma设计稿修改图标尺寸为23x23px */
				height: 23px;
				margin-right: 12px;
				display: flex;
				align-items: center;
				justify-content: center;

				image {
					width: 100%;
					height: 100%;
				}
			}

			.payment-name {
				flex: 1;
				font-size: 14px; /* 根据Figma设计稿调整字体大小 */
				color: #333333;
			}

			.payment-check {
				width: 20px; /* 根据Figma设计稿调整单选按钮尺寸 */
				height: 20px;
				border-radius: 50%;
				border: 1px solid #DDDDDD;
				position: relative;

				&.active {
					border-color: #FF7E00; /* 根据Figma设计稿调整颜色 */

					&:after {
						content: '';
						position: absolute;
						width: 12px;
						height: 12px;
						background-color: #FF7E00; /* 根据Figma设计稿调整颜色 */
						border-radius: 50%;
						top: 50%;
						left: 50%;
						transform: translate(-50%, -50%);
					}
				}
			}
		}

		.more-payment {
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 13px; /* 根据Figma设计稿调整字体大小 */
			color: #999999;
			padding: 15px 0;

			image {
				width: 12px; /* 根据Figma设计稿调整箭头图标尺寸 */
				height: 12px;
				margin-left: 5px;
			}
		}
	}

	.payment-btn {
		height: 50px; /* 根据Figma设计稿调整按钮高度 */
		background: linear-gradient(to right, #FF7E00, #FDA44D); /* 根据Figma设计稿调整为渐变背景 */
		display: flex;
		align-items: center;
		justify-content: center;

		text {
			color: #FFFFFF;
			font-size: 16px;
			font-weight: 500;
		}
	}
}
</style>